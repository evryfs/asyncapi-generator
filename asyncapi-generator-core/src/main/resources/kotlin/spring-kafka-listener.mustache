package {{packageName}}

import org.apache.kafka.clients.consumer.ConsumerRecord
import org.slf4j.LoggerFactory
import org.springframework.kafka.annotation.KafkaListener
import org.springframework.stereotype.Component
import org.springframework.boot.autoconfigure.condition.ConditionalOnBean
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty
{{#imports}}
import {{{.}}}
{{/imports}}


/**
{{#description}}
 * {{{.}}}
{{/description}}
 */
@Component
@ConditionalOnBean({{handlerInterface}}::class)
@ConditionalOnProperty(name = ["{{topicPropertyKey}}"])
class {{name}}(
    private val handler: {{handlerInterface}}
) {

    private val log = LoggerFactory.getLogger({{name}}::class.java)
{{=<% %>=}}
    @KafkaListener(topics = ["\${<%topicPropertyKey%>}"], groupId = "<%groupId%>")
<%={{ }}=%>    fun listen(record: ConsumerRecord<String, Any>) {
        val payload = record.value()
        when (payload) {
            {{#messageDispatches}}
            is {{payloadType}} -> {
                log.debug("Dispatching {{payloadType}} from topic {{topic}}")

                handler.{{methodName}}(record as ConsumerRecord<String, {{payloadType}}>)
            }
            {{/messageDispatches}}
            else -> {
                log.warn("Received unknown message type on topic {{topic}}: {}", payload::class.java.name)
            }
        }
    }
}
